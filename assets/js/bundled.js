const menu=document.getElementById("menu-page");const content=document.getElementById("content");function close_menu(){menu.style.visibility="hidden";content.style.visibility="visible";content.style.display="block"}function show_menu(){menu.style.visibility="visible";content.style.visibility="hidden";content.style.display="none"}function toggle_submenu(i){if(!window.event.ctrlKey){item=document.getElementsByClassName('has-submenu')[i];item_link=document.getElementsByClassName('submenu-link')[i];item_link_icon=document.getElementsByClassName('submenu-link-icon')[i];submenu=document.getElementsByClassName('submenu')[i];if(item.classList.contains("submenu-active")){item.classList.remove("submenu-active");item_link.classList.remove("submenu-link-active");item_link_icon.classList.remove("fa-angle-up-png");item_link_icon.classList.add("fa-angle-down-png");submenu.style.display="none"}else {item.classList.add("submenu-active");item_link.classList.add("submenu-link-active");item_link_icon.classList.add("fa-angle-up-png");item_link_icon.classList.remove("fa-angle-down-png");submenu.style.display="flex"}}}const root_item=document.querySelector(":root");let cycle_hue_vars=["--rnbw-color"];const cycle_mode_focus=0,cycle_mode_mouse=1;let current_hue=100,hue_translate=1,cycle_hue_active=0,active_hue_listeners=0,cycle_hue_count=0,cycle_hue_mode=cycle_mode_focus,cycle_hue_sleep=500;function cycle_hue_sleep_fn(ms){return new Promise(resolve=> setTimeout(resolve,ms))}function hsla_string(h,p,o){return"hsl("+h+"deg,"+p+"%,"+p+"%,"+o+")"}function hsl_string(h,p){return"hsl("+h+"deg,"+p+"%,"+p+"%)"}function hsl_rainbow(h){return"hsl("+h+"deg, 50%, 50%)"}function hsl_sherbet(h){return"hsl("+h+"deg, 75%, 75%)"}function filter_string(h){return"invert(66%) sepia(32%) saturate(812%) hue-rotate("+h+"deg) brightness(92%) contrast(92%)"}function iterate_hue(){current_hue=(current_hue+hue_translate)%360;for(let i=0,t=0;t<360;++i,t+=30)root_item.style.setProperty("--rnbw-color-"+i,hsl_rainbow((current_hue+t)%360));root_item.style.setProperty("--rnbw-color",hsl_rainbow(current_hue));root_item.style.setProperty("--rnbw-color-hover",hsl_rainbow((current_hue+180)%360))}async function start_cycling_hue(){if(++cycle_hue_count==1){cycle_hue_active=1;while(cycle_hue_active){iterate_hue();await cycle_hue_sleep_fn(cycle_hue_sleep)}}--cycle_hue_count}function stop_cycling_hue(){cycle_hue_active=0}function add_cycle_hue_listeners(){if(cycle_hue_mode==cycle_mode_focus){active_hue_listeners=1;window.addEventListener("focus",start_cycling_hue);window.addEventListener("blur",stop_cycling_hue)}else if(cycle_hue_mode==cycle_mode_mouse){active_hue_listeners=1;document.getElementById("body").addEventListener("mouseenter",start_cycling_hue);document.getElementById("body").addEventListener("mouseleave",stop_cycling_hue)}}function remove_cycle_hue_listeners(){if(!active_hue_listeners){alert("no active hue listeners");return}else if(cycle_hue_mode==cycle_mode_focus){active_hue_listeners=0;window.removeEventListener("focus",start_cycling_hue);window.removeEventListener("blur",stop_cycling_hue)}else if(cycle_hue_mode==cycle_mode_mouse){active_hue_listeners=0;document.getElementById("body").removeEventListener("mouseenter",start_cycling_hue);document.getElementById("body").removeEventListener("mouseleave",stop_cycling_hue)}}function set_cycle_mode(mode){if(mode==cycle_hue_mode)alert("cycle hue mode is already '"+mode+"'");else if(mode==cycle_mode_focus||mode==cycle_mode_mouse){remove_cycle_hue_listeners();cycle_hue_mode=mode;add_cycle_hue_listeners()}else alert("do not recognise cycle hue mode '"+mode+"'")}function cycle_hue_init(){iterate_hue();add_cycle_hue_listeners()}cycle_hue_init();start_cycling_hue();let editor_container=document.getElementById("editor-container");let editor_content=document.getElementById("editor-content");let editor=document.getElementById('editor');let pos=0,length=0,line_no=0,no_lines=1;const bsKey=8,tabKey=9,enterKey=13,shiftKey=16,ctrlKey=17,altKey=18,capsKey=20,escKey=27,leftKey=37,upKey=38,rightKey=39,downKey=40,insertKey=45,delKey=46,metaKey=91;function new_editor_content_size(){editor.style.marginTop=-(editor_content.clientHeight)+"px"}new ResizeObserver(()=> new_editor_content_size()).observe(editor_content);function redraw_editor(){editor_content.innerHTML=editor.innerText.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll("-","&#8288;-&#8288;").replaceAll("\n\n","\n")+'\n';microlight.reset([editor_content])}editor.innerHTML=editor.innerText.replaceAll("\n\n","<div><br></div>").replaceAll("\n","<div></div>")+'<div><br></div>';redraw_editor();function insert_tab(){if(!window.getSelection)return;const sel=window.getSelection();if(!sel.rangeCount)return;const range=sel.getRangeAt(0);range.collapse(true);const span=document.createElement('span');span.appendChild(document.createTextNode('\t'));span.style.whiteSpace='pre';range.insertNode(span);range.setStartAfter(span);range.collapse(true);sel.removeAllRanges();sel.addRange(range)}function key_press_old(e){let key=e.keyCode;if(key==tabKey){e.preventDefault();insert_tab()}redraw_editor()}const mantis_editor=document.getElementById("mantis-editor");mantis_editor.innerHTML=mantis_editor.innerText+'\n';function key_press(e){switch(e.keyCode){case upKey:return;case downKey:return;case leftKey:return;case rightKey:return;case shiftKey:return;case ctrlKey:return;case metaKey:return;case altKey:return;case capsKey:return;case escKey:return}if(!window.getSelection)return;const sel=window.getSelection();let currentNode=sel.focusNode.parentNode;let to_check=[mantis_editor];let pos=sel.focusOffset,childNo=0;for(let i=0;i<to_check.length;++i){for(let n=0;n<to_check[i].childNodes.length;++n){if(to_check[i].childNodes[n]==sel.focusNode){i=to_check.length;break}if(to_check[i].childNodes[n].nodeType==3){pos+=to_check[i].childNodes[n].textContent.length}else {if(to_check[i].childNodes[n].childNodes.length)to_check.push(to_check[i].childNodes[n]);else ++pos}}}e.preventDefault();let txt=mantis_editor.innerText;switch(e.keyCode){case bsKey:if(!pos)return;--pos;if(pos<txt.length)mantis_editor.innerHTML=txt.slice(0,pos)+txt.slice(pos+1);else mantis_editor.innerHTML=txt.slice(0,pos);break;case tabKey:if(pos<txt.length)mantis_editor.innerHTML=txt.slice(0,pos)+'\t'+txt.slice(pos);else mantis_editor.innerHTML=txt.slice(0,pos)+'\t';++pos;break;case enterKey:if(pos<txt.length)mantis_editor.innerHTML=txt.slice(0,pos)+'\n'+txt.slice(pos);else mantis_editor.innerHTML=txt.slice(0,pos)+'\n';++pos;break;default:if(pos<txt.length)mantis_editor.innerHTML=txt.slice(0,pos)+e.key+txt.slice(pos);else mantis_editor.innerHTML=txt.slice(0,pos)+e.key;++pos}microlight.reset([mantis_editor]);if(!sel.rangeCount)return;const range=sel.getRangeAt(0);to_check=[mantis_editor];for(let i=0;i<to_check.length;++i){for(let n=0;n<to_check[i].childNodes.length;++n){if(to_check[i].childNodes[n].nodeType==3){if(pos<to_check[i].childNodes[n].length){if(e.keyCode==leftKey){range.setStart(to_check[i].childNodes[n],pos);range.setEnd(to_check[i].childNodes[n],pos)}else range.setStart(to_check[i].childNodes[n],pos);i=to_check.length;break}else pos-=to_check[i].childNodes[n].textContent.length}else {if(to_check[i].childNodes[n].childNodes.length)to_check.push(to_check[i].childNodes[n]);else if(pos)--pos;else {if(e.keyCode==leftKey){range.setStart(to_check[i].childNodes[n],0);range.setEnd(to_check[i].childNodes[n],0)}else range.setStart(to_check[i].childNodes[n],0);i=to_check.length;break}}}}sel.removeAllRanges();sel.addRange(range)}